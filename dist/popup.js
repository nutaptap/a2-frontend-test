(()=>{function e(e){var o=document.getElementById("profile-img");o.src=e.photoURL,o.alt=e.email,document.querySelector(".login-container").style.display="none",document.querySelector(".app-container").style.display="block",chrome.storage.sync.set({user:e},(function(){console.log("User information stored in Chrome storage:",e)}))}chrome.runtime.sendMessage({type:"get_last_log"},(function(e){chrome.runtime.lastError?console.error("Error fetching last log:",chrome.runtime.lastError.message):e&&e.data?document.getElementById("log-display").textContent=JSON.stringify(e.data,null,2):document.getElementById("log-display").textContent="No logs available."})),chrome.storage.sync.get("user",(function(o){chrome.runtime.lastError?console.error("Error fetching user from storage:",chrome.runtime.lastError.message):o.user?(console.log("User found in storage:",o.user),e(o.user)):console.log("No user found in storage.")})),document.getElementById("login").onclick=function(){chrome.runtime.sendMessage({type:"get_auth_token"},(function(e){if(chrome.runtime.lastError)console.error("Error fetching auth token:",chrome.runtime.lastError.message);else if(e&&e.token){var o=e.token;console.log("Token fetched from background:",o),document.getElementById("firebase-iframe").contentWindow.postMessage({type:"login",token:o},"*")}else console.error("Failed to fetch token:",e.error)}))},window.addEventListener("message",(function(o){"loginSuccess"===o.data.type?(console.log("Login successful, user object sent to popup:",o.data.user),e(o.data.user)):"loginError"===o.data.type&&console.error("Login error:",o.data.error)}))})();