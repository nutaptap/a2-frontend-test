(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function r(t,n,r){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}var o={user_id:"",appContext:document.location.href,setting:1,sourceId:"demo",studyId:"",text:[],timeZone:(new Date).getTimezoneOffset()/-60,startUnixTime:Date.now(),pressTimes:[],releaseTimes:[],keyAreas:[],keyTypes:[],click:[],positionX:[],positionY:[],pressure:[],swipe:[],autocorrectLengths:[0],autocorrectTimes:[],autocorrectWords:[],predictionLength:null,predictionLengths:[],predictionTimes:[],predictionWords:[],textStructure:[]},s=n({},o),i=!1;function c(){chrome.storage.sync.get("user",(function(e){e.user.uid?(s.user_id=e.user.uid,console.log("User set in typing data")):console.log("No user found in storage.")}))}c();var a,u,l=(a=function(){if(i&&""!==s.user_id){var e,t;(e=s.pressTimes.length)>(t=s.releaseTimes.length)?(console.log("The array was trimmed, keydown was longer"),s.pressTimes.length=t):t>e&&(console.log("The array was trimmed, keyup was longer"),s.releaseTimes.length=e);var r=0;!function e(){try{console.log("Attempting to send typing data:",JSON.stringify(s,null,2)),chrome.runtime.sendMessage({type:"log_key",data:s},(function(t){if(chrome.runtime.lastError)return console.error("Error sending message:",chrome.runtime.lastError.message,chrome.runtime.lastError),void(r<3&&(r++,console.log("Retrying to send typing data (attempt ".concat(r,")")),e()));console.log("Typing data sent successfully"),s=n({},o),c(),i=!1,console.log("Typing data reset")}))}catch(e){console.error("Error during sendTypingData:",e)}}()}},function(){var e=this,t=arguments;clearTimeout(u),u=setTimeout((function(){return a.apply(e,t)}),5e3)});function g(){i||(i=!0,s.startUnixTime=Date.now())}var p={};document.addEventListener("click",(function(e){!function(e){g();var t={time:Date.now(),target_element:e.target.tagName.toLowerCase(),target_role:e.target.role,target_text:e.target.value||e.target.innerText},n=e.pageX,r=e.pageY;s.click.push(t),s.positionX.push(n),s.positionY.push(r)}(e)})),document.addEventListener("keydown",(function(e){!function(e){g(),p[e.key]||(p[e.key]=Date.now(),s.pressTimes.push(Date.now()),s.keyTypes.push(e.key),s.text.push(e.key))}(e)})),document.addEventListener("keyup",(function(e){!function(e){p[e.key]&&(s.releaseTimes.push(Date.now()),delete p[e.key]),"Enter"===e.key&&l()}(e)})),document.addEventListener("focusout",(function(e){!function(e){e.target.classList.contains("message_input")&&(console.log("Focus out detected on message input"),l()),e.relatedTarget&&e.relatedTarget.closest(".message_input")||(console.log("Focus out detected"),l())}(e)})),window.addEventListener("sendMessage",(function(){console.log("sendMessage event detected"),l()}))})();